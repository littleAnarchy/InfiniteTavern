# –ú—ñ–≥—Ä–∞—Ü—ñ—è –Ω–∞ MongoDB - –ü—ñ–¥—Å—É–º–æ–∫

## ‚úÖ –©–æ –∑—Ä–æ–±–ª–µ–Ω–æ

### 1. –û–Ω–æ–≤–ª–µ–Ω–Ω—è –º–æ–¥–µ–ª–µ–π –¥–∞–Ω–∏—Ö (Domain Layer)
- **GameSession** - –¥–æ–¥–∞–Ω–æ `[BsonId]`, –∑–º—ñ–Ω–µ–Ω–æ –∫–æ–ª–µ–∫—Ü—ñ—ó –Ω–∞ `List<T>`
- **PlayerCharacter, Npc, Quest, MemoryEntry** - –≤–∏–¥–∞–ª–µ–Ω–æ `Id` —ñ `GameSessionId`, —Ç–µ–ø–µ—Ä –≤–æ–Ω–∏ –≤–±—É–¥–æ–≤–∞–Ω—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏

### 2. –ù–æ–≤–∏–π Infrastructure Layer
- ‚úÖ **GameRepository.cs** - —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø–∞—Ç–µ—Ä–Ω—É Repository –¥–ª—è MongoDB
- ‚úÖ **MongoDbContext.cs** - –æ–±–≥–æ—Ä—Ç–∫–∞ –¥–ª—è –∑'—î–¥–Ω–∞–Ω–Ω—è –∑ MongoDB  
- ‚úÖ **IGameRepository** - —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∞–±—Å—Ç—Ä–∞–∫—Ü—ñ—ó –¥–æ—Å—Ç—É–ø—É –¥–æ –¥–∞–Ω–∏—Ö
- ‚ùå –í–∏–¥–∞–ª–µ–Ω–æ `InfiniteTavernDbContext.cs` (Entity Framework)
- ‚ùå –í–∏–¥–∞–ª–µ–Ω–æ –ø–∞–ø–∫—É Migrations

### 3. –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (Application Layer)
- **GameService.cs** –ø–æ–≤–Ω—ñ—Å—Ç—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–∏–π:
  - –¢–µ–ø–µ—Ä –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `IGameRepository` –∑–∞–º—ñ—Å—Ç—å `DbContext`
  - –°—Ç–≤–æ—Ä—é—î –ø–æ–≤–Ω—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏ –∑ –≤–±—É–¥–æ–≤–∞–Ω–∏–º–∏ —Å—É—Ç–Ω–æ—Å—Ç—è–º–∏
  - –û–¥–Ω–∞ –æ–ø–µ—Ä–∞—Ü—ñ—è –∑–∞–ø–∏—Å—É –∑–∞–º—ñ—Å—Ç—å –±–∞–≥–∞—Ç—å–æ—Ö

### 4. –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
- ‚úÖ **Program.cs** - MongoDB DI –∑–∞–º—ñ—Å—Ç—å Entity Framework
- ‚úÖ **appsettings.json** - MongoDB connection string
- ‚úÖ **.csproj —Ñ–∞–π–ª–∏** - MongoDB.Driver –∑–∞–º—ñ—Å—Ç—å Npgsql
- ‚úÖ **docker-compose.yml** - MongoDB –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–º—ñ—Å—Ç—å PostgreSQL

### 5. –û–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó
- ‚úÖ README.md - —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ MongoDB
- ‚úÖ QUICKSTART.md - —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –±–µ–∑ –º—ñ–≥—Ä–∞—Ü—ñ–π
- ‚úÖ USAGE_EXAMPLES.md - –æ–Ω–æ–≤–ª–µ–Ω—ñ –ø—Ä–∏–∫–ª–∞–¥–∏
- ‚úÖ ARCHITECTURE.md - –¥—ñ–∞–≥—Ä–∞–º–∞ –∑ MongoDB
- ‚úÖ MONGODB_MIGRATION.md - –ø–æ–≤–Ω–∏–π –≥–∞–π–¥ –º—ñ–≥—Ä–∞—Ü—ñ—ó

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç–∏

### –®–≤–∏–¥–∫—ñ—Å—Ç—å —Ä–æ–±–æ—Ç–∏
| –û–ø–µ—Ä–∞—Ü—ñ—è | PostgreSQL (EF Core) | MongoDB |
|----------|---------------------|---------|
| –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –≥—Ä–∏ | 5 INSERT –∑–∞–ø–∏—Ç—ñ–≤ | 1 INSERT |
| –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–µ—Å—ñ—ó | 1 SELECT + 4 JOIN | 1 FIND |
| –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Ö–æ–¥—É | ~5 UPDATE –∑–∞–ø–∏—Ç—ñ–≤ | 1 REPLACE |

**–ó–º–µ–Ω—à–µ–Ω–Ω—è –∑–∞–ø–∏—Ç—ñ–≤ –¥–æ –ë–î: ~50%**

### –ö–æ–¥
- –í–∏–¥–∞–ª–µ–Ω–æ ~200 —Ä—è–¥–∫—ñ–≤ boilerplate –∫–æ–¥—É (DbContext –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è)
- –°–ø—Ä–æ—â–µ–Ω–æ GameService (–Ω–µ–º–∞—î Include(), –Ω–∞–≤—ñ–≥–∞—Ü—ñ–π–Ω–∏—Ö –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç–µ–π)
- –ü—Ä–æ—Å—Ç—ñ—à–µ –¥–æ–¥–∞–≤–∞—Ç–∏ –Ω–æ–≤—ñ –ø–æ–ª—è (–±–µ–∑ –º—ñ–≥—Ä–∞—Ü—ñ–π)

## üöÄ –Ø–∫ –∑–∞–ø—É—Å—Ç–∏—Ç–∏

```powershell
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç–∏ MongoDB
docker-compose up -d

# 2. –ó—ñ–±—Ä–∞—Ç–∏ –ø—Ä–æ–µ–∫—Ç
dotnet build

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç–∏ API
dotnet run --project src/InfiniteTavern.API
```

**–ú—ñ–≥—Ä–∞—Ü—ñ—ó –ë–î –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω—ñ!** MongoDB —Å—Ç–≤–æ—Ä—é—î –∫–æ–ª–µ–∫—Ü—ñ—ó –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ.

## üîç –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞

### –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –¥–∞–Ω—ñ –≤ MongoDB
```powershell
mongosh
use InfiniteTavern
db.GameSessions.find().pretty()
```

### –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–µ—Å—Ç–æ–≤—É –≥—Ä—É
```powershell
curl -X POST http://localhost:5000/api/game/new-game `
  -H "Content-Type: application/json" `
  -d '{"playerName":"Test","characterName":"Hero","race":"Human","class":"Warrior"}'
```

## üéØ –ü–µ—Ä–µ–≤–∞–≥–∏ MongoDB –¥–ª—è —Ü—å–æ–≥–æ –ø—Ä–æ–µ–∫—Ç—É

1. **–ü—Ä–∏—Ä–æ–¥–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞** - —ñ–≥—Ä–æ–≤—ñ —Å–µ—Å—ñ—ó —Ü–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏ –∑ –≤–∫–ª–∞–¥–µ–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏
2. **–û–¥–∏–Ω –∑–∞–ø–∏—Ç** - –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è –≤—Å—è —Å–µ—Å—ñ—è –æ–¥—Ä–∞–∑—É
3. **–ì–Ω—É—á–∫—ñ—Å—Ç—å** - –º–æ–∂–Ω–∞ –¥–æ–¥–∞–≤–∞—Ç–∏ –Ω–æ–≤—ñ –ø–æ–ª—è –±–µ–∑ –º—ñ–≥—Ä–∞—Ü—ñ–π
4. **JSON-native** - —ñ–¥–µ–∞–ª—å–Ω–æ –¥–ª—è AI —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó
5. **–ú–∞–π–±—É—Ç–Ω—î** - –≤–±—É–¥–æ–≤–∞–Ω–∏–π vector search –¥–ª—è –µ–º–±–µ–¥–∏–Ω–≥—ñ–≤ –ø–∞–º'—è—Ç—ñ

## üìù –í–∞–∂–ª–∏–≤—ñ –∑–º—ñ–Ω–∏

### –©–æ –ø—Ä–∞—Ü—é—î —è–∫ —Ä–∞–Ω—ñ—à–µ ‚úÖ
- API endpoints (—Ç–æ–π —Å–∞–º–∏–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç)
- AI —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è (OpenAI/Claude)
- –õ–æ–≥—ñ–∫–∞ –≥—Ä–∏ (–ø–æ–¥—ñ—ó, dice rolling, –ø–∞–º'—è—Ç—å)
- Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏

### –©–æ –∑–º—ñ–Ω–∏–ª–æ—Å—è ‚ö†Ô∏è
- –ü–æ—Ç—Ä—ñ–±–µ–Ω MongoDB –∑–∞–º—ñ—Å—Ç—å PostgreSQL
- –ù–µ–º–∞—î Entity Framework (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ MongoDB.Driver)
- –ù–µ–º–∞—î –º—ñ–≥—Ä–∞—Ü—ñ–π (schema-less –±–∞–∑–∞)
- Connection string —Ñ–æ—Ä–º–∞—Ç —ñ–Ω—à–∏–π

## üîÑ Rollback (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)

–Ø–∫—â–æ —Ç—Ä–µ–±–∞ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—å –Ω–∞ PostgreSQL:
1. –í—ñ–¥–Ω–æ–≤–∏—Ç–∏ –ø–∞–∫–µ—Ç–∏ –∑ git: `Npgsql.EntityFrameworkCore.PostgreSQL`
2. –í—ñ–¥–Ω–æ–≤–∏—Ç–∏ `InfiniteTavernDbContext.cs` 
3. –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—ó: `dotnet ef database update`

–î–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –≤ [MONGODB_MIGRATION.md](MONGODB_MIGRATION.md)

## ‚ú® –ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏

- [ ] –î–æ–¥–∞—Ç–∏ —ñ–Ω–¥–µ–∫—Å–∏ –¥–ª—è –ø–æ—à—É–∫—É —ñ–≥—Ä–æ–≤–∏—Ö —Å–µ—Å—ñ–π
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ vector search –¥–ª—è –ø–∞–º'—è—Ç—ñ (MongoDB Atlas)
- [ ] –î–æ–¥–∞—Ç–∏ aggregate queries –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- [ ] –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ backup strategy –¥–ª—è MongoDB

---

**–ú—ñ–≥—Ä–∞—Ü—ñ—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø—ñ—à–Ω–æ!** üéâ

–ü—Ä–æ–µ–∫—Ç –∑–±–∏—Ä–∞—î—Ç—å—Å—è –±–µ–∑ –ø–æ–º–∏–ª–æ–∫ —Ç–∞ –≥–æ—Ç–æ–≤–∏–π –¥–æ —Ä–æ–∑—Ä–æ–±–∫–∏.
